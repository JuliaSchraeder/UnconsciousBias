---
title: "Questionnaire_Analysis_2"
output: html_document
date: "2024-02-29"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Import Library

```{r}
library(readxl)
library(rstatix)
library(ggplot2)
library(apaTables)
library(ez)
library(dplyr)
library(tidyr)
library(car)
library(emmeans)
library(ggplot2)
```

# Import Dataset

```{r}
data <- read_excel("/Users/julia/Desktop/Git/EEGfMRIStudy/data/BackwardMask_Questionnaire_Results.xlsx", 
                 col_types = c("text", 
         "numeric", "numeric", "numeric", 
         "numeric", "numeric", "numeric", "numeric",  
         "numeric", "numeric", "numeric", 
         "numeric", "numeric", "numeric", 
         "numeric", "numeric", "numeric", 
         "numeric", "numeric", "numeric", 
         "numeric", "numeric", "numeric", 
         "numeric", "numeric", "numeric", 
         "numeric", "text", "numeric", "numeric", 
         "numeric", "numeric", "numeric", 
         "numeric", "numeric", "numeric", 
         "numeric", "numeric", "numeric", 
         "numeric", "numeric", "numeric", 
         "numeric", "numeric", "numeric", 
         "numeric", "numeric", "numeric", 
         "numeric"), na = "na")

head(data)
```


# FB Analysis


## Rename Questionnaires 


```{r}

data <- data

colnames(data)[colnames(data) == "BDI-II Sum score"] ="BDI"
colnames(data)[colnames(data) == "BVAQ_New"] ="BVAQ"
colnames(data)[colnames(data) == "WMS Correct"] ="WMS"
colnames(data)[colnames(data) == "TM A"] ="TMT_A"
colnames(data)[colnames(data) == "TM B"] ="TMT_B"

colnames(data)[colnames(data) == "DERS_Gesamtwert"] ="DERS_sum_score"
colnames(data)[colnames(data) == "DERS_Nicht-Akzeptanz emotionalerReaktionen"] ="DERS_non_acceptance"
colnames(data)[colnames(data) == "DERS_Probleme mit zielorientiertem Verhalten"] ="DERS_goals"
colnames(data)[colnames(data) == "DERS_Impulskontrollprobleme"] ="DERS_impulse"
colnames(data)[colnames(data) == "DERS_Mangel an emotionaler Aufmerksamkeit"] ="DERS_awareness"
colnames(data)[colnames(data) == "DERS_EingeschrÃ¤nkter Zugang zu Emotionsregulations-Strategien"] ="DERS_strategies"
colnames(data)[colnames(data) == "DERS_Mangel an emotionaler Klarheit"] ="DERS_clarity"

colnames(data)[colnames(data) == "CERQ_Selbstbeschuldigung"] ="CERQ_self_blame"
colnames(data)[colnames(data) == "CERQ_Akzeptanz"] ="CERQ_acceptance"
colnames(data)[colnames(data) == "CERQ_Rumination"] ="CERQ_rumination"
colnames(data)[colnames(data) == "CERQ_Positive Refokussierung"] ="CERQ_positive_reinforcement"
colnames(data)[colnames(data) == "CERQ_Refokussierung auf Planung"] ="CERQ_refocus_on_planning"
colnames(data)[colnames(data) == "CERQ_Positive Neubewertung"] ="CERQ_positive_reappraisal"
colnames(data)[colnames(data) == "CERQ_Relativieren"] ="CERQ_putting_into_perspective"
colnames(data)[colnames(data) == "CERQ_Katastrophisierung"] ="CERQ_catastrophizing"
colnames(data)[colnames(data) == "CERQ_Andere Beschuldigen"] ="CERQ_blaming_others"

colnames(data)[colnames(data) == "Hamilton Score"] ="Hamilton_Score"

colnames(data)[colnames(data) == "DigitSpan_Forwards_Span"] ="Digit_forward_span"
colnames(data)[colnames(data) == "DigitSpan_ForwardsTotal Score"] ="Digit_forward_score"
colnames(data)[colnames(data) == "DigitSpan_Backwards_Span"] ="Digit_backward_span"
colnames(data)[colnames(data) == "DigitSpan_Backwards_Total Score"] ="Digit_backward_score"
```

## look at dataset

```{r}
tibble(data)
```


## take only columns i need
# Transform data
```{r}

d_FB <- data[c('Group_MDD1_HC2', "BVAQ", "WMS", "TMT_A", "TMT_B", "STAI1", "STAI2",
             "DERS_sum_score", "DERS_non_acceptance", "DERS_goals", "DERS_impulse", "DERS_awareness", "DERS_strategies", "DERS_clarity",
             "CERQ_self_blame", "CERQ_acceptance", "CERQ_rumination", "CERQ_positive_reinforcement", "CERQ_refocus_on_planning",
             "CERQ_positive_reappraisal", "CERQ_putting_into_perspective", "CERQ_catastrophizing", "CERQ_blaming_others",
             "Digit_forward_span", "Digit_forward_score", "Digit_backward_span", "Digit_backward_score")]
```


## remove rows with missing values

```{r}
# Remove NA values from the dataset
data_FB_clean <- na.omit(d_FB)

# Check the dimensions of the cleaned dataset
dim(data_FB_clean)

# Use the cleaned dataset for further analysis

```


# Perform MANOVA

If you have multiple questionnaires and want to compare the sum scores between two groups while controlling for multiple comparisons, you can use a multivariate approach such as a multivariate analysis of variance (MANOVA) or a permutation-based approach.


```{r}
# Assuming 'manova_out' is the result object from your MANOVA analysis
manova_out <- manova(cbind(BVAQ, WMS, TMT_A, TMT_B, STAI1, STAI2,
                           DERS_sum_score, DERS_non_acceptance, DERS_goals, DERS_impulse, DERS_awareness, DERS_strategies, DERS_clarity,
                           CERQ_self_blame, CERQ_acceptance, CERQ_rumination, CERQ_positive_reinforcement, CERQ_refocus_on_planning,
                           CERQ_positive_reappraisal, CERQ_putting_into_perspective, CERQ_catastrophizing, CERQ_blaming_others,
                           Digit_forward_span, Digit_forward_score, Digit_backward_span, Digit_backward_score) 
                     ~ Group_MDD1_HC2,
                     data = data_FB_clean)
summary(manova_out, tol=0)

# Extract the dependent variable names
dependent_vars <- c("BVAQ", "WMS", "TMT_A", "TMT_B", "STAI1", "STAI2",
                    "DERS_sum_score", "DERS_non_acceptance", "DERS_goals", "DERS_impulse", "DERS_awareness", "DERS_strategies", "DERS_clarity",
                    "CERQ_self_blame", "CERQ_acceptance", "CERQ_rumination", "CERQ_positive_reinforcement", "CERQ_refocus_on_planning",
                    "CERQ_positive_reappraisal", "CERQ_putting_into_perspective", "CERQ_catastrophizing", "CERQ_blaming_others",
                    "Digit_forward_span", "Digit_forward_score", "Digit_backward_span", "Digit_backward_score")

```





```{r}
# Load necessary libraries
library(tidyverse)
library(broom)
library(effsize)

# Read the data
data <- data_FB_clean


# Function to perform t-tests and calculate effect sizes
analyze_diff <- function(data, group_col, measure_col) {
  group1 <- data %>% filter(!!sym(group_col) == 1) %>% pull(!!sym(measure_col))
  group2 <- data %>% filter(!!sym(group_col) == 2) %>% pull(!!sym(measure_col))
  t_test <- t.test(group1, group2, var.equal = FALSE)
  effect_size <- cohen.d(group1, group2)$estimate
  
  # Make sure to name the elements of the returned vector
  return(c(t_value = t_test$statistic, 
           p_value = t_test$p.value, 
           effect_size = effect_size))
}

# Initialize an empty data frame to store results
results <- tibble(Variable = character(), 
                  T_Value = numeric(), 
                  P_Value = numeric(), 
                  Cohen_d = numeric())

# Loop through each questionnaire column (excluding the group column)
for (column in colnames(data)[-which(colnames(data) == "Group_MDD1_HC2")]) {
  diff_res <- analyze_diff(data, "Group_MDD1_HC2", column)
  
  # Construct a tibble for each result and add it to the results dataframe
  temp_results <- tibble(Variable = column, 
                         T_Value = as.numeric(diff_res['t_value']), 
                         P_Value = as.numeric(diff_res['p_value']), 
                         Cohen_d = as.numeric(diff_res['effect_size'])
  results <- bind_rows(results, temp_results)
}

# Adjust p-values for multiple comparisons (Bonferroni correction)
results$Bonferroni_Corrected_P <- p.adjust(results$P_Value, method = "bonferroni")

# Display the results
print(results)

# Optionally, write the results to a CSV file
#write.csv(results, "path/to/your_results.csv", row.names = FALSE)

```




